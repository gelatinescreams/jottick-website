<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>JotTick : Notes, Checklists, Tasks & Calendar for Home Assistant</title>
  <meta name="description" content="A notes, checklists, and task management integration for Home Assistant. Includes per device notifications, voice assistant reminders, recurring lists, Kanban boards, and calendar integration.">
  <meta name="keywords" content="JotTick, Home Assistant, HACS, notes, checklists, tasks, todo, task management, home automation, smart home, notifications, reminders, recurring tasks, Lovelace, dashboard, family organization, shopping list, productivity, calendar, iCal, Kanban">
  <meta name="author" content="gelatinescreams">
  
  <meta property="og:title" content="JotTick : Notes, Checklists, Tasks & Calendar for Home Assistant">
  <meta property="og:description" content="Jot notes. Tick tasks. Get notified. A powerful notes, checklists, and task management integration for Home Assistant with mobile notifications, voice reminders, and calendar sync.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://github.com/gelatinescreams/JotTick">
  <meta property="og:image" content="https://raw.githubusercontent.com/gelatinescreams/jottick-website/main/logo_readme.png">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="JotTick : Notes, Checklists, Tasks & Calendar for Home Assistant">
  <meta name="twitter:description" content="A notes, checklists, and task management integration for Home Assistant with voice reminders and calendar sync.">
  <meta name="twitter:image" content="https://raw.githubusercontent.com/gelatinescreams/jottick-website/main/logo_readme.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0d0d14;
      --bg-secondary: #151520;
      --bg-card: #1a1a28;
      --bg-elevated: #22222f;
      --bg-sidebar: #101018;
      --accent: #03a9f4;
      --accent-hover: #29b6f6;
      --accent-muted: rgba(3, 169, 244, 0.15);
      --text-primary: #f0f0f5;
      --text-secondary: #8888a0;
      --text-muted: #5a5a70;
      --border: #2a2a3a;
      --success: #34d399;
      --success-muted: rgba(52, 211, 153, 0.15);
      --error: #f87171;
      --error-muted: rgba(248, 113, 113, 0.15);
      --warning: #fbbf24;
      --purple: #a78bfa;
      --purple-muted: rgba(167, 139, 250, 0.15);
      --radius: 12px;
      --radius-sm: 8px;
      --sidebar-width: 56px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { overflow-x: hidden; max-width: 100vw; }
    body { font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.5; display: flex; }
    
    .sidebar { width: var(--sidebar-width); background: var(--bg-sidebar); border-right: 1px solid var(--border); height: 100vh; position: fixed; left: 0; top: 0; display: flex; flex-direction: column; z-index: 200; transition: width 0.2s ease; overflow: hidden; }
    .sidebar:hover { width: 256px; }
    .sidebar-header { padding: 12px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; min-height: 56px; }
    .ha-logo { width: 32px; height: 32px; flex-shrink: 0; }
    .ha-title { font-size: 1.1rem; font-weight: 600; white-space: nowrap; opacity: 0; transition: opacity 0.2s; }
    .sidebar:hover .ha-title { opacity: 1; }
    .sidebar-nav { flex: 1; overflow-y: auto; padding: 8px 0; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px; color: var(--text-secondary); cursor: pointer; transition: all 0.15s; border-left: 3px solid transparent; }
    .nav-item:hover { background: var(--bg-elevated); color: var(--text-primary); }
    .nav-item.active { background: var(--accent-muted); color: var(--accent); border-left-color: var(--accent); }
    .nav-icon { width: 24px; text-align: center; font-size: 1.2rem; flex-shrink: 0; }
    .nav-label { white-space: nowrap; font-size: 0.9rem; opacity: 0; transition: opacity 0.2s; }
    .sidebar:hover .nav-label { opacity: 1; }
    .nav-divider { height: 1px; background: var(--border); margin: 8px 12px; }
    .sidebar-footer { padding: 12px; border-top: 1px solid var(--border); display: flex; align-items: center; gap: 12px; }
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 600; color: white; flex-shrink: 0; }
    .user-name { font-size: 0.85rem; color: var(--text-secondary); white-space: nowrap; opacity: 0; transition: opacity 0.2s; }
    .sidebar:hover .user-name { opacity: 1; }
    
    .app-container { flex: 1; margin-left: var(--sidebar-width); min-height: 100vh; display: flex; flex-direction: column; max-width: calc(100vw - var(--sidebar-width)); overflow-x: hidden; }
    .header { background: var(--bg-secondary); border-bottom: 1px solid var(--border); padding: 12px 24px; position: sticky; top: 0; z-index: 100; display: flex; align-items: center; justify-content: space-between; }
    .header-left { display: flex; align-items: center; gap: 12px; }
    .header-title { font-size: 1.25rem; font-weight: 600; display: flex; align-items: center; gap: 10px; }
    .header-title img { width: 28px; height: 28px; border-radius: 6px; }
    .demo-badge { background: var(--accent-muted); color: var(--accent); padding: 4px 10px; border-radius: 16px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }
    .header-actions { display: flex; gap: 8px; }
    .header-btn { background: var(--bg-elevated); border: 1px solid var(--border); color: var(--text-secondary); padding: 8px 12px; border-radius: var(--radius-sm); font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.15s; text-decoration: none; }
    .header-btn:hover { background: var(--border); color: var(--text-primary); }
    .mobile-menu-btn { display: none; background: none; border: none; color: var(--text-primary); font-size: 1.5rem; cursor: pointer; padding: 4px 8px; }

    .tabs-container { background: var(--bg-secondary); border-bottom: 1px solid var(--border); padding: 0 24px; overflow-x: auto; }
    .tabs { display: flex; gap: 4px; }
    .tab { padding: 14px 20px; background: none; border: none; color: var(--text-secondary); font-family: inherit; font-size: 0.9rem; font-weight: 500; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.15s; display: flex; align-items: center; gap: 8px; white-space: nowrap; }
    .tab:hover { color: var(--text-primary); }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .tab-icon { font-size: 1rem; }
    .tab-count { background: var(--bg-elevated); padding: 2px 7px; border-radius: 10px; font-size: 0.7rem; color: var(--text-muted); }
    .tab.active .tab-count { background: var(--accent-muted); color: var(--accent); }

    .main { flex: 1; padding: 24px; overflow-x: hidden; }
    .tab-content { display: none; animation: fadeIn 0.25s ease; }
    .tab-content.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    
    .section-grid { display: grid; grid-template-columns: 1fr 320px; gap: 20px; margin-bottom: 24px; }
    .section-full { grid-column: 1 / -1; }

    .create-form { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; }
    .form-title { font-size: 0.95rem; font-weight: 600; margin-bottom: 14px; }
    .form-row { display: flex; gap: 12px; margin-bottom: 12px; }
    .form-row:last-child { margin-bottom: 0; }
    input[type="text"], input[type="password"], input[type="url"], input[type="datetime-local"], input[type="time"], input[type="date"], textarea, select {
      background: var(--bg-elevated); border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 10px 12px; color: var(--text-primary); font-family: inherit; font-size: 0.9rem; width: 100%; transition: border-color 0.15s, box-shadow 0.15s;
    }
    input::placeholder, textarea::placeholder { color: var(--text-muted); }
    input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-muted); }
    textarea { min-height: 100px; resize: vertical; }

    .btn { background: var(--accent); color: #fff; border: none; border-radius: var(--radius-sm); padding: 10px 18px; font-family: inherit; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.15s; display: inline-flex; align-items: center; gap: 6px; white-space: nowrap; }
    .btn:hover { background: var(--accent-hover); transform: translateY(-1px); }
    .btn-secondary { background: var(--bg-elevated); color: var(--text-primary); border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--border); }
    .btn-danger { background: var(--error); }
    .btn-success { background: var(--success); color: #000; }
    .btn-purple { background: var(--purple); color: #000; }
    .btn-sm { padding: 6px 10px; font-size: 0.8rem; }

    .format-toggle { display: flex; border-radius: 6px; overflow: hidden; border: 1px solid var(--border); width: fit-content; margin-bottom: 12px; }
    .format-toggle button { padding: 6px 14px; background: var(--bg-elevated); color: var(--text-secondary); border: none; cursor: pointer; font-size: 0.85em; transition: all 0.2s; }
    .format-toggle button.active { background: var(--accent); color: white; }

    .options-row { display: flex; gap: 16px; margin-bottom: 12px; align-items: center; flex-wrap: wrap; }
    .option-group { display: flex; align-items: center; gap: 6px; font-size: 0.85rem; color: var(--text-secondary); }
    .option-group input[type="checkbox"] { accent-color: var(--accent); }
    .password-field { display: none; margin-bottom: 12px; }
    .password-field.show { display: block; }

    .image-preview { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
    .preview-thumb { width: 60px; height: 60px; border-radius: 6px; overflow: hidden; position: relative; }
    .preview-thumb img { width: 100%; height: 100%; object-fit: cover; }
    .preview-remove { position: absolute; top: 2px; right: 2px; background: var(--error); color: white; border: none; width: 18px; height: 18px; border-radius: 50%; font-size: 0.7rem; cursor: pointer; }
    .file-label { display: inline-flex; align-items: center; gap: 6px; padding: 10px 16px; background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 80%, #000)); color: white; border-radius: var(--radius-sm); cursor: pointer; font-size: 0.9rem; font-weight: 500; box-shadow: 0 2px 8px rgba(0,0,0,0.15); transition: all 0.2s; }
    .file-label:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    .file-label input { display: none; }

    .assist-config { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; margin-bottom: 20px; }
    .assist-config h3 { font-size: 1rem; margin-bottom: 6px; }
    .assist-config .help { font-size: 0.85em; color: var(--text-secondary); margin-bottom: 12px; }
    .assist-section { background: var(--bg-elevated); border-radius: 8px; padding: 12px; margin-bottom: 12px; }
    .assist-section:last-child { margin-bottom: 0; }
    .assist-section-title { font-weight: 600; font-size: 0.9em; margin-bottom: 8px; }
    .assist-config select, .assist-config input[type="text"] { margin-bottom: 8px; }
    .assist-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; background: var(--bg-card); border-radius: 6px; margin: 4px 0; font-size: 0.85em; }
    .assist-item .del { padding: 4px 10px; background: var(--error); color: white; font-size: 0.8em; border: none; border-radius: 4px; cursor: pointer; }
    .assist-empty { font-style: italic; color: var(--text-muted); font-size: 0.85em; }
    .assist-status { font-size: 0.85em; color: var(--accent); margin-top: 8px; min-height: 18px; }
    .assist-pending { padding: 6px 10px; background: var(--bg-card); border-radius: 6px; margin: 4px 0; font-size: 0.85em; display: flex; justify-content: space-between; align-items: center; }

    .mini-cal { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; }
    .mini-cal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
    .mini-cal-title { font-size: 0.95em; font-weight: 600; display: flex; align-items: center; gap: 6px; }
    .mini-cal-nav { display: flex; gap: 4px; }
    .mini-cal-nav button { background: var(--bg-elevated); border: 1px solid var(--border); color: var(--text-primary); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.85em; }
    .mini-cal-nav button:hover { background: var(--border); }
    .mini-cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; font-size: 0.75em; }
    .mini-cal-dow { text-align: center; padding: 4px 2px; color: var(--text-muted); font-weight: 600; }
    .mini-cal-day { text-align: center; padding: 6px 2px; cursor: pointer; border-radius: 4px; position: relative; }
    .mini-cal-day:hover { background: var(--bg-elevated); }
    .mini-cal-day.other { color: var(--text-muted); opacity: 0.5; }
    .mini-cal-day.today { background: var(--accent-muted); font-weight: 700; color: var(--accent); }
    .mini-cal-day.has-events::after { content: ''; position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; border-radius: 50%; background: var(--accent); }
    .mini-cal-day.has-due::after { background: var(--success); }
    .mini-cal-day.has-overdue::after { background: var(--error); }
    .mini-cal-events { margin-top: 10px; border-top: 1px solid var(--border); padding-top: 10px; max-height: 120px; overflow-y: auto; }
    .mini-cal-event { display: flex; align-items: center; gap: 6px; padding: 4px 0; font-size: 0.85em; cursor: pointer; }
    .mini-cal-event:hover { color: var(--accent); }
    .mini-cal-event-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
    .mini-cal-event-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .mini-cal-empty { font-size: 0.8em; color: var(--text-muted); text-align: center; padding: 8px; }
    .mini-cal-link { display: block; text-align: center; margin-top: 8px; font-size: 0.8em; color: var(--accent); cursor: pointer; }
    .mini-cal-link:hover { text-decoration: underline; }
    .mini-cal-overdue { background: var(--error-muted); border: 1px solid var(--error); border-radius: 6px; padding: 8px; margin-bottom: 10px; font-size: 0.85em; display: flex; align-items: center; gap: 6px; color: var(--error); }

    .notes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(min(100%, 400px), 1fr)); gap: 16px; }
    .note-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; transition: all 0.15s; }
    .note-card:hover { border-color: var(--accent); box-shadow: 0 4px 20px rgba(3, 169, 244, 0.08); }
    .note-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
    .note-title { font-size: 1rem; font-weight: 600; flex: 1; }
    .note-badges { display: flex; gap: 6px; margin-left: 8px; flex-wrap: wrap; }
    .badge { padding: 2px 7px; border-radius: 5px; font-size: 0.65rem; font-weight: 600; text-transform: uppercase; }
    .badge-md { background: rgba(96, 165, 250, 0.2); color: #60a5fa; }
    .badge-locked { background: rgba(248, 113, 113, 0.2); color: var(--error); }
    .badge-voice { background: var(--success-muted); color: var(--success); }
    .note-content { color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 10px; line-height: 1.6; word-wrap: break-word; }
    .note-timestamp { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 10px; }
    .note-actions { display: flex; gap: 8px; padding-top: 10px; border-top: 1px solid var(--border); flex-wrap: wrap; }
    .btn-wrapper { position: relative; display: inline-block; }
    .btn-badge { position: absolute; top: -6px; right: -6px; background: var(--error); color: white; font-size: 0.65rem; padding: 2px 6px; border-radius: 10px; font-weight: 600; }

    .lists-container, #tasks-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(min(100%, 380px), 1fr)); gap: 16px; }
    .list-card, .task-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; }
    .list-header, .task-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; padding-bottom: 10px; border-bottom: 2px solid var(--accent); flex-wrap: wrap; gap: 8px; }
    .list-title, .task-title { font-size: 1rem; font-weight: 600; }
    .list-progress { background: var(--accent); color: #fff; padding: 3px 10px; border-radius: 10px; font-size: 0.75rem; font-weight: 600; }
    .list-items, .task-items { margin-bottom: 14px; }
    .list-item, .task-item { display: flex; align-items: center; gap: 10px; padding: 8px 10px; background: var(--bg-elevated); border-radius: var(--radius-sm); margin-bottom: 6px; transition: all 0.15s; }
    .list-item:hover, .task-item:hover { background: var(--border); }
    .item-checkbox { width: 18px; height: 18px; cursor: pointer; accent-color: var(--accent); flex-shrink: 0; }
    .item-text { flex: 1; font-size: 0.9rem; word-wrap: break-word; }
    .item-text.completed { text-decoration: line-through; color: var(--text-muted); }
    .item-delete { opacity: 0; transition: opacity 0.15s; }
    .list-item:hover .item-delete { opacity: 1; }
    .add-item-form { display: flex; gap: 8px; margin-bottom: 12px; }
    .list-actions, .task-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .config-badge { font-size: 0.65rem; padding: 3px 8px; border-radius: 4px; margin-left: 8px; background: var(--success-muted); color: var(--success); }
    .config-badge.reminder-active { background: var(--purple-muted); color: var(--purple); }

    .status-pill { padding: 4px 10px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; cursor: pointer; transition: all 0.15s; }
    .status-pill:hover { filter: brightness(1.1); }
    .task-item.depth-1 { margin-left: 20px; }
    .task-item.depth-2 { margin-left: 40px; }
    
    .panel { margin-top: 12px; padding: 14px; border-radius: var(--radius-sm); display: none; }
    .panel.show { display: block; }
    .panel-recurring { background: var(--success-muted); border: 1px solid rgba(52, 211, 153, 0.3); }
    .panel-reminder { background: var(--purple-muted); border: 1px solid rgba(167, 139, 250, 0.3); }
    .panel-send { background: rgba(96, 165, 250, 0.1); border: 1px solid rgba(96, 165, 250, 0.3); }
    .panel-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
    .panel-recurring .panel-title { color: var(--success); }
    .panel-reminder .panel-title { color: var(--purple); }
    .panel-send .panel-title { color: #60a5fa; }
    .panel-row { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; align-items: center; }
    .panel-label { font-size: 0.8rem; color: var(--text-secondary); min-width: 60px; }
    .panel-devices { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
    .device-check { display: flex; align-items: center; gap: 5px; font-size: 0.85rem; cursor: pointer; padding: 6px 10px; background: var(--bg-card); border-radius: 6px; border: 1px solid var(--border); }
    .device-check input { accent-color: var(--accent); }
    .panel-actions { display: flex; gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); flex-wrap: wrap; }
    .day-selector { display: flex; gap: 4px; flex-wrap: wrap; }
    .day-btn { padding: 6px 10px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 4px; color: var(--text-secondary); font-size: 0.75rem; cursor: pointer; }
    .day-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }

    .calendar-container { display: grid; grid-template-columns: 1fr 320px; gap: 24px; }
    .calendar-main { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; }
    .calendar-sidebar { display: flex; flex-direction: column; gap: 16px; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px; }
    .calendar-nav { display: flex; gap: 8px; align-items: center; }
    .calendar-nav-btn { background: var(--bg-elevated); border: 1px solid var(--border); color: var(--text-primary); width: 36px; height: 36px; border-radius: 6px; cursor: pointer; font-size: 1rem; }
    .calendar-nav-btn:hover { background: var(--border); }
    .calendar-month-title { font-size: 1.2rem; font-weight: 600; min-width: 180px; text-align: center; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--border); border-radius: 8px; overflow: hidden; }
    .calendar-weekday { background: var(--bg-elevated); padding: 12px 8px; text-align: center; font-size: 0.75rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }
    .calendar-day { background: var(--bg-card); min-height: 80px; padding: 6px; position: relative; cursor: pointer; transition: all 0.15s; }
    .calendar-day:hover { background: var(--bg-elevated); }
    .calendar-day.other-month { background: var(--bg-primary); opacity: 0.5; }
    .calendar-day.today { background: var(--accent-muted); }
    .calendar-day.today .day-number { background: var(--accent); color: white; border-radius: 50%; width: 26px; height: 26px; display: flex; align-items: center; justify-content: center; }
    .day-number { font-size: 0.85rem; font-weight: 500; margin-bottom: 4px; }
    .day-events { display: flex; flex-direction: column; gap: 2px; }
    .day-event { font-size: 0.65rem; padding: 2px 4px; border-radius: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; cursor: pointer; }
    .day-event:hover { filter: brightness(1.2); }
    .day-more { font-size: 0.6rem; color: var(--text-muted); padding: 2px; }
    
    .calendar-panel { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; }
    .calendar-panel-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .ical-input-group { margin-bottom: 12px; }
    .ical-input-group label { display: block; font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 4px; }
    .ical-sources { margin-top: 12px; }
    .ical-source { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; background: var(--bg-elevated); border-radius: 6px; margin-bottom: 6px; font-size: 0.8rem; }
    .ical-source-name { color: var(--text-primary); }
    .ical-source-status { font-size: 0.7rem; color: var(--success); }
    .color-settings { display: flex; flex-direction: column; gap: 8px; }
    .color-row { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; }
    .color-label { font-size: 0.8rem; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }
    .color-preview { width: 12px; height: 12px; border-radius: 3px; }
    .color-input { width: 50px; height: 26px; border: none; border-radius: 4px; cursor: pointer; background: transparent; }
    .upcoming-events { max-height: 250px; overflow-y: auto; }
    .upcoming-event { display: flex; gap: 10px; padding: 10px; background: var(--bg-elevated); border-radius: 8px; margin-bottom: 8px; align-items: flex-start; }
    .upcoming-event-dot { width: 10px; height: 10px; border-radius: 50%; margin-top: 4px; flex-shrink: 0; }
    .upcoming-event-content { flex: 1; min-width: 0; }
    .upcoming-event-title { font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .upcoming-event-time { font-size: 0.75rem; color: var(--text-muted); }
    .overdue-banner { background: var(--error-muted); border: 1px solid var(--error); border-radius: 8px; padding: 12px 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
    .overdue-banner .overdue-count { font-weight: 700; color: var(--error); }

    .kanban-container { display: flex; flex-direction: column; gap: 24px; }
    .kanban-task-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; }
    .kanban-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid var(--accent); flex-wrap: wrap; gap: 8px; }
    .kanban-title { font-size: 1.1rem; font-weight: 600; }
    .kanban-progress { background: var(--accent); color: #fff; padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; }
    .kanban-board { display: flex; gap: 16px; overflow-x: auto; padding-bottom: 8px; }
    .kanban-board.vertical { flex-direction: column; }
    .kanban-column { min-width: 220px; flex: 1; background: var(--bg-elevated); border-radius: 10px; padding: 12px; display: flex; flex-direction: column; }
    .kanban-board.vertical .kanban-column { min-width: auto; }
    .kanban-col-header { display: flex; align-items: center; gap: 8px; padding: 10px; margin-bottom: 10px; border-radius: 8px; font-weight: 600; font-size: 0.95rem; }
    .kanban-col-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
    .kanban-col-count { margin-left: auto; background: rgba(255,255,255,0.2); padding: 2px 10px; border-radius: 10px; font-size: 0.8rem; }
    .kanban-dropzone { flex: 1; min-height: 60px; border: 2px dashed transparent; border-radius: 8px; padding: 8px; transition: all 0.2s; display: flex; flex-direction: column; gap: 8px; }
    .kanban-dropzone.drag-over { background: var(--accent-muted); border-color: var(--accent); }
    .kanban-item { background: var(--bg-card); border-radius: 8px; padding: 12px; cursor: grab; border-left: 4px solid; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: transform 0.15s, box-shadow 0.15s; }
    .kanban-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    .kanban-item.dragging { opacity: 0.5; }
    .kanban-item-text { font-size: 0.9rem; }
    .kanban-empty { text-align: center; padding: 20px; color: var(--text-muted); font-style: italic; font-size: 0.85rem; }
    .kanban-add-row { display: flex; gap: 8px; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border); }
    .kanban-add-row input { flex: 1; padding: 8px 10px; font-size: 0.85rem; }
    .kanban-layout-btn { padding: 6px 12px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 6px; color: var(--text-secondary); font-size: 0.8rem; cursor: pointer; margin-right: 10px; }
    
    .mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 250; }
    .mobile-overlay.show { display: block; }
    .mobile-menu { position: fixed; left: -280px; top: 0; width: 280px; height: 100vh; background: var(--bg-sidebar); z-index: 300; display: flex; flex-direction: column; transition: left 0.3s ease; }
    .mobile-menu.show { left: 0; }
    .mobile-menu-header { padding: 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
    .mobile-menu-header .logo-area { display: flex; align-items: center; gap: 12px; }
    .mobile-menu-header img { width: 32px; height: 32px; border-radius: 6px; }
    .mobile-menu-header span { font-weight: 600; font-size: 1.1rem; }
    .mobile-menu-close { background: none; border: none; color: var(--text-secondary); font-size: 1.2rem; cursor: pointer; }
    .mobile-menu-nav { flex: 1; overflow-y: auto; padding: 12px 0; }
    .mobile-nav-item { display: flex; align-items: center; gap: 12px; padding: 14px 20px; color: var(--text-secondary); text-decoration: none; font-size: 0.95rem; }
    .mobile-nav-item:hover { background: var(--bg-elevated); color: var(--text-primary); }
    .mobile-nav-item.active { background: var(--accent-muted); color: var(--accent); }
    .mobile-nav-divider { height: 1px; background: var(--border); margin: 12px 16px; }
    .mobile-nav-section { padding: 8px 20px 6px; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); }
    .mobile-menu-footer { padding: 16px; border-top: 1px solid var(--border); }
    .mobile-menu-footer .reset-btn { width: 100%; padding: 12px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text-secondary); font-family: inherit; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
    
    .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--bg-card); border: 1px solid var(--border); padding: 12px 24px; border-radius: var(--radius); font-size: 0.9rem; z-index: 1001; opacity: 0; transition: all 0.3s ease; }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    
    .empty-state { text-align: center; padding: 48px 24px; color: var(--text-muted); }
    .empty-icon { font-size: 3rem; margin-bottom: 12px; }
    .empty-text { font-size: 1.1rem; margin-bottom: 6px; }
    .empty-hint { font-size: 0.85rem; }
    
    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
    .modal-overlay.show { display: flex; }
    .modal-image { max-width: 90vw; max-height: 90vh; border-radius: var(--radius); }
    .modal-close { position: absolute; top: 20px; right: 20px; background: var(--bg-elevated); border: none; color: var(--text-primary); width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; }
    
    @media (max-width: 1024px) {
      .section-grid { grid-template-columns: 1fr; }
      .calendar-container { grid-template-columns: 1fr; }
      .calendar-sidebar { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    }
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .app-container { margin-left: 0; max-width: 100vw; }
      .header { padding: 12px 16px; }
      .header-actions { display: none; }
      .mobile-menu-btn { display: block; }
      .tabs-container { padding: 0 16px; }
      .tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; }
      .tab { padding: 12px 14px; font-size: 0.85rem; }
      .main { padding: 16px; }
      .notes-grid, .lists-container, #tasks-container { grid-template-columns: 1fr; }
      .form-row { flex-direction: column; }
      .add-item-form { flex-direction: column; }
      .add-item-form .btn { width: 100%; justify-content: center; }
      .calendar-day { min-height: 50px; padding: 4px; }
      .day-events { display: none; }
      .calendar-day.has-events::after { content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; background: var(--accent); border-radius: 50%; }
      .kanban-board { flex-direction: column !important; }
      .kanban-column { min-width: auto !important; }
    }
    
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
  </style>
</head>
<body>
<div class="mobile-overlay" id="mobile-overlay" onclick="toggleMobileMenu()"></div>
<div class="mobile-menu" id="mobile-menu">
  <div class="mobile-menu-header">
    <div class="logo-area">
      <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='10' y='10' width='80' height='80' rx='15' fill='%2303a9f4'/%3E%3Cpath d='M30 55 L45 70 L75 35' stroke='%23fff' stroke-width='10' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3C/svg%3E" alt="JotTick">
      <span>JotTick</span>
    </div>
    <button class="mobile-menu-close" onclick="toggleMobileMenu()">‚úï</button>
  </div>
  <nav class="mobile-menu-nav">
    <div class="mobile-nav-section">Demo Navigation</div>
    <a href="#" class="mobile-nav-item active" onclick="switchTabMobile('notes')">üìù Notes</a>
    <a href="#" class="mobile-nav-item" onclick="switchTabMobile('lists')">‚òëÔ∏è Checklists</a>
    <a href="#" class="mobile-nav-item" onclick="switchTabMobile('tasks')">üìã Tasks</a>
    <a href="#" class="mobile-nav-item" onclick="switchTabMobile('kanban')">üìä Kanban</a>
    <a href="#" class="mobile-nav-item" onclick="switchTabMobile('calendar')">üìÖ Calendar</a>
    <div class="mobile-nav-divider"></div>
    <div class="mobile-nav-section">Links</div>
    <a href="https://github.com/gelatinescreams/JotTick" target="_blank" class="mobile-nav-item">‚≠ê GitHub Repository</a>
    <a href="https://github.com/gelatinescreams/JotTick#installation" target="_blank" class="mobile-nav-item">üì• Installation Guide</a>
  </nav>
  <div class="mobile-menu-footer">
    <button class="reset-btn" onclick="location.reload()">üîÑ Reset Demo</button>
  </div>
</div>

<aside class="sidebar">
  <div class="sidebar-header">
    <svg class="ha-logo" viewBox="0 0 240 240">
      <path fill="#18BCF2" d="M240 224.762c0 8.416-6.822 15.238-15.238 15.238H15.238C6.822 240 0 233.178 0 224.762V15.238C0 6.822 6.822 0 15.238 0h209.524C233.178 0 240 6.822 240 15.238v209.524z"/>
      <path fill="#fff" d="M120 40L40 120h50v80h60v-80h50L120 40z"/>
    </svg>
    <span class="ha-title">Home Assistant</span>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-item"><span class="nav-icon">üè†</span><span class="nav-label">Overview</span></div>
    <div class="nav-item"><span class="nav-icon">‚ö°</span><span class="nav-label">Energy</span></div>
    <div class="nav-item"><span class="nav-icon">üìä</span><span class="nav-label">History</span></div>
    <div class="nav-divider"></div>
    <div class="nav-item active"><span class="nav-icon">üìù</span><span class="nav-label">JotTick</span></div>
    <div class="nav-item"><span class="nav-icon">üì∫</span><span class="nav-label">Media</span></div>
    <div class="nav-divider"></div>
    <div class="nav-item"><span class="nav-icon">‚öôÔ∏è</span><span class="nav-label">Settings</span></div>
  </nav>
  <div class="sidebar-footer">
    <div class="user-avatar">D</div>
    <span class="user-name">Demo User</span>
  </div>
</aside>

<div class="app-container">
  <header class="header">
    <div class="header-left">
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()">‚ò∞</button>
      <div class="header-title">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect x='10' y='10' width='80' height='80' rx='15' fill='%2303a9f4'/%3E%3Cpath d='M30 55 L45 70 L75 35' stroke='%23fff' stroke-width='10' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3C/svg%3E" alt="JotTick">
        JotTick
      </div>
      <span class="demo-badge">Interactive Demo</span>
    </div>
    <div class="header-actions">
      <a href="https://github.com/gelatinescreams/JotTick" target="_blank" class="header-btn">‚≠ê GitHub</a>
      <button class="header-btn" onclick="location.reload()">üîÑ Reset Demo</button>
    </div>
  </header>

  <div class="tabs-container">
    <div class="tabs">
      <button class="tab active" data-tab="notes"><span class="tab-icon">üìù</span>Notes<span class="tab-count" id="notes-count">0</span></button>
      <button class="tab" data-tab="lists"><span class="tab-icon">‚òëÔ∏è</span>Checklists<span class="tab-count" id="lists-count">0</span></button>
      <button class="tab" data-tab="tasks"><span class="tab-icon">üìã</span>Tasks<span class="tab-count" id="tasks-count">0</span></button>
      <button class="tab" data-tab="kanban"><span class="tab-icon">üìä</span>Kanban</button>
      <button class="tab" data-tab="calendar"><span class="tab-icon">üìÖ</span>Calendar</button>
    </div>
  </div>

  <main class="main">
    <div class="tab-content active" id="notes-tab">
      <div class="section-grid">
        <div>
          <div class="create-form">
            <div class="form-title">New Note</div>
            <div class="form-row"><input type="text" id="note-title" placeholder="Title"></div>
            <div class="format-toggle">
              <button type="button" class="active" data-format="html" onclick="setNoteFormat(this, 'html')">HTML</button>
              <button type="button" data-format="md" onclick="setNoteFormat(this, 'md')">Markdown</button>
            </div>
            <div class="form-row"><textarea id="note-content" placeholder="Content (HTML tags accepted)"></textarea></div>
            <div class="options-row">
              <div class="option-group"><label><input type="checkbox" id="note-lock-toggle" onchange="document.getElementById('password-field').classList.toggle('show', this.checked)"> üîí Password protect</label></div>
            </div>
            <div class="password-field" id="password-field"><input type="password" id="note-password" placeholder="Enter password to lock note"></div>
            <div class="image-preview" id="note-images"></div>
            <div class="form-row" style="align-items:center;">
              <label class="file-label">üì∑ Add Image<input type="file" id="note-image-input" accept="image/*"></label>
              <button class="btn" onclick="createNote()">Create</button>
            </div>
          </div>
          
          <div class="assist-config">
            <h3>üéôÔ∏è Assist Reminder Settings</h3>
            <p class="help">Say "Remind me to..." or "Remind [name] to..." and notifications go to the right phone!</p>
            
            <div class="assist-section">
              <div class="assist-section-title">My Device (for "Remind Me")</div>
              <select id="user-select">
                <option value="">-- Select your HA user --</option>
                <option value="user1">Dad</option>
                <option value="user2">Mom</option>
                <option value="user3">Kids</option>
              </select>
              <select id="user-device-select">
                <option value="">-- Select device --</option>
                <option value="notify.mobile_app_dads_phone">Dad's Phone</option>
                <option value="notify.mobile_app_moms_phone">Mom's Phone</option>
                <option value="notify.mobile_app_tablet">Kitchen Tablet</option>
              </select>
              <button class="btn btn-sm" onclick="saveUserDevice()">Save My Device</button>
              <div id="user-devices-list"></div>
            </div>
            
            <div class="assist-section">
              <div class="assist-section-title">Name Aliases (for "Remind Mom/Tim/Dad")</div>
              <input type="text" id="alias-names" placeholder="Names separated by commas (e.g. tim, timmy, dad)">
              <select id="alias-device-select">
                <option value="">-- Select device --</option>
                <option value="notify.mobile_app_dads_phone">Dad's Phone</option>
                <option value="notify.mobile_app_moms_phone">Mom's Phone</option>
                <option value="notify.mobile_app_tablet">Kitchen Tablet</option>
              </select>
              <button class="btn btn-sm" onclick="saveAlias()">Save Alias</button>
              <div id="aliases-list"></div>
            </div>
            
            <div class="assist-section">
              <div class="assist-section-title">Pending Assist Reminders</div>
              <div id="pending-reminders"></div>
            </div>
            
            <div class="assist-status" id="assist-status"></div>
          </div>
        </div>
        
        <div>
          <div class="mini-cal" id="notes-mini-cal"></div>
        </div>
      </div>
      
      <div class="notes-grid" id="notes-container"></div>
    </div>

    <div class="tab-content" id="lists-tab">
      <div class="section-grid">
        <div>
          <div class="create-form">
            <div class="form-title">Create New Checklist</div>
            <div class="form-row">
              <input type="text" id="list-title" placeholder="Checklist title...">
              <button class="btn" onclick="createList()">Create Checklist</button>
            </div>
          </div>
        </div>
        <div>
          <div class="mini-cal" id="lists-mini-cal"></div>
        </div>
      </div>
      <div class="lists-container" id="lists-container"></div>
    </div>

    <div class="tab-content" id="tasks-tab">
      <div class="section-grid">
        <div>
          <div class="create-form">
            <div class="form-title">Create New Task List</div>
            <div class="form-row">
              <input type="text" id="task-list-title" placeholder="Task list title...">
              <button class="btn" onclick="createTaskList()">Create Task List</button>
            </div>
          </div>
        </div>
        <div>
          <div class="mini-cal" id="tasks-mini-cal"></div>
        </div>
      </div>
      <div id="tasks-container"></div>
    </div>

    <div class="tab-content" id="kanban-tab">
      <div class="kanban-container" id="kanban-container"></div>
    </div>

    <div class="tab-content" id="calendar-tab">
      <div id="overdue-banner-container"></div>
      <div class="calendar-container">
        <div class="calendar-main">
          <div class="calendar-header">
            <div class="calendar-nav">
              <button class="calendar-nav-btn" onclick="changeMonth(-1)">‚óÄ</button>
              <span class="calendar-month-title" id="calendar-month-title">December 2025</span>
              <button class="calendar-nav-btn" onclick="changeMonth(1)">‚ñ∂</button>
              <button class="btn btn-sm btn-secondary" onclick="goToToday()" style="margin-left:8px;">Today</button>
            </div>
            <button class="btn btn-sm btn-secondary" onclick="toggleCalendarSettings()">‚öôÔ∏è Settings</button>
          </div>
          <div class="calendar-grid" id="calendar-grid"></div>
        </div>
        
        <div class="calendar-sidebar">
          <div class="calendar-panel">
            <div class="calendar-panel-title">üìÖ Upcoming Events</div>
            <div class="upcoming-events" id="upcoming-events"></div>
          </div>
          
          <div class="calendar-panel">
            <div class="calendar-panel-title">üì• iCal Import</div>
            <div class="ical-input-group">
              <label>Calendar URL (.ics)</label>
              <input type="url" id="ical-url" placeholder="https://calendar.google.com/...">
            </div>
            <div class="ical-input-group">
              <label>Calendar Name</label>
              <input type="text" id="ical-name" placeholder="Work Calendar">
            </div>
            <button class="btn btn-sm" onclick="importIcal()" style="width:100%;">Import Calendar</button>
            <div class="ical-sources" id="ical-sources"></div>
          </div>
          
          <div class="calendar-panel">
            <div class="calendar-panel-title">üé® Event Colors</div>
            <div class="color-settings" id="color-settings"></div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="modal-overlay" id="image-modal" onclick="closeImageModal()">
  <button class="modal-close" onclick="closeImageModal()">√ó</button>
  <img src="" alt="" class="modal-image" id="modal-image" onclick="event.stopPropagation()">
</div>

<div class="toast" id="toast"></div>

<script>
let notes = [];
let lists = [];
let taskLists = [];
let noteImages = [];
let currentFormat = 'html';
let scheduledNotes = {};
let listRecurring = {};
let listReminders = {};
let taskReminders = {};
let userDevices = {};
let aliases = {};
let pendingReminders = [];
let currentDate = new Date();
let calendarEvents = [];
let icalSources = [];
let eventColors = {
  'note-created': '#3b82f6',
  'note-edited': '#8b5cf6',
  'note-reminder': '#f59e0b',
  'list-created': '#99C66D',
  'list-edited': '#7AAD52',
  'list-due': '#10b981',
  'task-due': '#F9E900',
  'task-overdue': '#ef4444',
  'imported': '#A855F7'
};

const devices = [
  { id: 'notify.mobile_app_dads_phone', name: "Dad's Phone" },
  { id: 'notify.mobile_app_moms_phone', name: "Mom's Phone" },
  { id: 'notify.mobile_app_tablet', name: 'Kitchen Tablet' }
];

document.addEventListener('DOMContentLoaded', () => {
  initTabs();
  initImageUpload();
  loadSampleData();
  renderAll();
});

function initTabs() {
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
      if (tab.dataset.tab === 'calendar') renderCalendar();
    });
  });
}

function initImageUpload() {
  document.getElementById('note-image-input').addEventListener('change', (e) => {
    if (e.target.files[0]) {
      const reader = new FileReader();
      reader.onload = (ev) => {
        noteImages.push({ name: e.target.files[0].name, data: ev.target.result });
        renderImagePreviews();
      };
      reader.readAsDataURL(e.target.files[0]);
    }
    e.target.value = '';
  });
}

function loadSampleData() {
  notes = [
    { id: generateId(), title: 'Welcome to JotTick! üëã', content: 'This is a demo of JotTick for Home Assistant. Try creating notes, lists, and tasks!', format: 'html', images: [], locked: false, created: new Date(Date.now() - 3600000).toISOString() },
    { id: generateId(), title: 'Voice Reminders', content: 'Say <strong>"Hey Google, remind me to..."</strong> and JotTick routes it to the right phone using the Assist settings above!', format: 'html', images: [], locked: false, created: new Date(Date.now() - 7200000).toISOString() },
    { id: generateId(), title: 'Markdown Note', content: '# Heading\nThis uses **markdown** formatting.\n- List item 1\n- List item 2\n> Blockquote', format: 'md', images: [], locked: false, created: new Date(Date.now() - 10800000).toISOString() }
  ];
  
  lists = [
    { id: generateId(), title: 'Grocery List', items: [{ text: 'Milk', completed: true }, { text: 'Eggs', completed: false }, { text: 'Bread', completed: false }], dueDate: formatDate(new Date(Date.now() + 86400000 * 2)) },
    { id: generateId(), title: 'Daily Routine', items: [{ text: 'Morning workout', completed: true }, { text: 'Check emails', completed: false }] }
  ];
  listRecurring[lists[1].id] = { days: ['mon','tue','wed','thu','fri'], times: '06:00' };
  
  const taskId = generateId();
  taskLists = [
    { id: taskId, title: 'Home Assistant Project', statuses: [
      { id: 'todo', label: 'To Do', color: '#6b7280', order: 0 },
      { id: 'in_progress', label: 'In Progress', color: '#3b82f6', order: 1 },
      { id: 'completed', label: 'Completed', color: '#10b981', order: 2 }
    ], items: [
      { id: generateId(), text: 'Install JotTick', status: 'completed', depth: 0 },
      { id: generateId(), text: 'Configure automations', status: 'in_progress', depth: 0, dueDate: formatDate(new Date(Date.now() + 86400000)) },
      { id: generateId(), text: 'Create dashboard', status: 'todo', depth: 0, dueDate: formatDate(new Date(Date.now() + 86400000 * 5)) }
    ]}
  ];
  
  userDevices = { 'user1': { name: 'Dad', device: 'notify.mobile_app_dads_phone' } };
  aliases = { 'mom': 'notify.mobile_app_moms_phone', 'mama': 'notify.mobile_app_moms_phone' };
  
  pendingReminders = [
    { id: generateId(), message: 'Pick up groceries', time: new Date(Date.now() + 3600000).toISOString(), device: "Dad's Phone" }
  ];
  
  icalSources = [
    { name: 'Work Calendar', url: 'https://calendar.google.com/...', status: 'synced' },
    { name: 'Family Events', url: 'https://outlook.live.com/...', status: 'synced' }
  ];
  
  generateCalendarEvents();
}

function setNoteFormat(btn, format) {
  document.querySelectorAll('.format-toggle button').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  currentFormat = format;
  document.getElementById('note-content').placeholder = format === 'md' ? 'Content (Markdown supported)' : 'Content (HTML tags accepted)';
}

function renderImagePreviews() {
  document.getElementById('note-images').innerHTML = noteImages.map((img, i) => `
    <div class="preview-thumb">
      <img src="${img.data}" alt="${img.name}">
      <button class="preview-remove" onclick="noteImages.splice(${i}, 1); renderImagePreviews();">√ó</button>
    </div>
  `).join('');
}

function createNote() {
  const title = document.getElementById('note-title').value.trim();
  const content = document.getElementById('note-content').value;
  const locked = document.getElementById('note-lock-toggle').checked;
  const password = document.getElementById('note-password').value;
  if (!title) { showToast('Please enter a title'); return; }
  if (locked && !password) { showToast('Please enter a password'); return; }
  
  notes.unshift({ id: generateId(), title, content, format: currentFormat, images: [...noteImages], locked, password: locked ? password : null, unlocked: false, created: new Date().toISOString() });
  
  document.getElementById('note-title').value = '';
  document.getElementById('note-content').value = '';
  document.getElementById('note-lock-toggle').checked = false;
  document.getElementById('note-password').value = '';
  document.getElementById('password-field').classList.remove('show');
  noteImages = [];
  renderImagePreviews();
  renderNotes();
  generateCalendarEvents();
  showToast('Note created!');
}

function deleteNote(id) {
  if (confirm('Delete this note?')) {
    notes = notes.filter(n => n.id !== id);
    renderNotes();
    generateCalendarEvents();
    showToast('Note deleted');
  }
}

function renderNotes() {
  const container = document.getElementById('notes-container');
  document.getElementById('notes-count').textContent = notes.length;
  
  if (notes.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">üìù</div><div class="empty-text">No notes yet</div><div class="empty-hint">Create your first note above</div></div>`;
    return;
  }
  
  container.innerHTML = notes.map(note => {
    const contentHtml = note.format === 'md' ? renderMarkdown(note.content) : note.content.replace(/\n/g, '<br>');
    return `<div class="note-card">
      <div class="note-header">
        <div class="note-title">${escapeHtml(note.title)}</div>
        <div class="note-badges">
          ${note.format === 'md' ? '<span class="badge badge-md">MD</span>' : ''}
          ${note.locked ? '<span class="badge badge-locked">üîí</span>' : ''}
        </div>
      </div>
      <div class="note-content">${contentHtml}</div>
      <div class="note-timestamp">${formatDateTime(note.created)}</div>
      <div class="note-actions">
        <button class="btn btn-sm btn-secondary" onclick="toggleSendPanel('${note.id}')">üì§ Send</button>
        <button class="btn btn-sm btn-danger" onclick="deleteNote('${note.id}')">Delete</button>
      </div>
    </div>`;
  }).join('');
  
  renderNotesMiniCal();
  renderAssistConfig();
}

function saveUserDevice() {
  const userId = document.getElementById('user-select').value;
  const device = document.getElementById('user-device-select').value;
  if (!userId || !device) { setAssistStatus('Please select both user and device'); return; }
  const userName = document.getElementById('user-select').options[document.getElementById('user-select').selectedIndex].text;
  userDevices[userId] = { name: userName, device };
  renderAssistConfig();
  setAssistStatus('Saved! "Remind me" now goes to ' + userName);
}

function saveAlias() {
  const names = document.getElementById('alias-names').value.trim();
  const device = document.getElementById('alias-device-select').value;
  if (!names || !device) { setAssistStatus('Please enter names and select device'); return; }
  names.split(',').forEach(n => { aliases[n.trim().toLowerCase()] = device; });
  document.getElementById('alias-names').value = '';
  renderAssistConfig();
  setAssistStatus('Saved! Say "remind ' + names.split(',')[0].trim() + ' to..."');
}

function deleteUserDevice(userId) {
  delete userDevices[userId];
  renderAssistConfig();
  setAssistStatus('Deleted');
}

function deleteAliasGroup(device) {
  Object.keys(aliases).forEach(k => { if (aliases[k] === device) delete aliases[k]; });
  renderAssistConfig();
  setAssistStatus('Deleted');
}

function cancelReminder(id) {
  pendingReminders = pendingReminders.filter(r => r.id !== id);
  renderAssistConfig();
  showToast('Reminder cancelled');
}

function setAssistStatus(msg) {
  document.getElementById('assist-status').textContent = msg;
  setTimeout(() => document.getElementById('assist-status').textContent = '', 3000);
}

function renderAssistConfig() {
  const userList = document.getElementById('user-devices-list');
  if (Object.keys(userDevices).length === 0) {
    userList.innerHTML = '<div class="assist-empty">No users mapped yet</div>';
  } else {
    userList.innerHTML = Object.entries(userDevices).map(([uid, data]) => `
      <div class="assist-item">
        <span>${data.name} ‚Üí ${data.device.replace('notify.mobile_app_','').replace(/_/g,' ')}</span>
        <button class="del" onclick="deleteUserDevice('${uid}')">√ó</button>
      </div>
    `).join('');
  }
  
  const aliasList = document.getElementById('aliases-list');
  const byDevice = {};
  Object.entries(aliases).forEach(([name, dev]) => {
    if (!byDevice[dev]) byDevice[dev] = [];
    byDevice[dev].push(name);
  });
  if (Object.keys(byDevice).length === 0) {
    aliasList.innerHTML = '<div class="assist-empty">No aliases yet</div>';
  } else {
    aliasList.innerHTML = Object.entries(byDevice).map(([dev, names]) => `
      <div class="assist-item">
        <span>${names.join(', ')} ‚Üí ${dev.replace('notify.mobile_app_','').replace(/_/g,' ')}</span>
        <button class="del" onclick="deleteAliasGroup('${dev}')">√ó</button>
      </div>
    `).join('');
  }
  
  const pendingList = document.getElementById('pending-reminders');
  if (pendingReminders.length === 0) {
    pendingList.innerHTML = '<div class="assist-empty">No pending reminders</div>';
  } else {
    pendingList.innerHTML = pendingReminders.map(r => `
      <div class="assist-pending">
        <span>‚Ä¢ ${r.message} @ ${formatDateTime(r.time)}</span>
        <button class="btn btn-sm btn-danger" onclick="cancelReminder('${r.id}')">√ó</button>
      </div>
    `).join('');
  }
}

function renderNotesMiniCal() {
  renderMiniCal('notes-mini-cal', 'note', notes.map(n => ({ date: n.created.split('T')[0], title: n.title, color: eventColors['note-created'] })));
}

function renderListsMiniCal() {
  const events = [];
  lists.forEach(l => {
    if (l.dueDate) events.push({ date: l.dueDate, title: l.title, color: eventColors['list-due'], type: 'due' });
  });
  renderMiniCal('lists-mini-cal', 'list', events);
}

function renderTasksMiniCal() {
  const events = [];
  let overdueCount = 0;
  const today = formatDate(new Date());
  taskLists.forEach(t => {
    t.items.forEach(item => {
      if (item.dueDate) {
        const isOverdue = item.dueDate < today && item.status !== 'completed';
        if (isOverdue) overdueCount++;
        events.push({ date: item.dueDate, title: item.text, color: isOverdue ? eventColors['task-overdue'] : eventColors['task-due'], type: isOverdue ? 'overdue' : 'due' });
      }
    });
  });
  renderMiniCal('tasks-mini-cal', 'task', events, overdueCount);
}

function renderMiniCal(containerId, type, events, overdueCount = 0) {
  const container = document.getElementById(containerId);
  const today = new Date();
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const todayStr = formatDate(today);
  
  const eventsByDate = {};
  events.forEach(e => {
    if (!eventsByDate[e.date]) eventsByDate[e.date] = [];
    eventsByDate[e.date].push(e);
  });
  
  let calDays = '';
  const dow = ['S','M','T','W','T','F','S'];
  dow.forEach(d => calDays += `<div class="mini-cal-dow">${d}</div>`);
  
  const prevMonthDays = new Date(year, month, 0).getDate();
  for (let i = firstDay - 1; i >= 0; i--) {
    calDays += `<div class="mini-cal-day other">${prevMonthDays - i}</div>`;
  }
  
  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const isToday = dateStr === todayStr;
    const dayEvents = eventsByDate[dateStr] || [];
    const hasEvents = dayEvents.length > 0;
    const hasDue = dayEvents.some(e => e.type === 'due');
    const hasOverdue = dayEvents.some(e => e.type === 'overdue');
    
    calDays += `<div class="mini-cal-day${isToday ? ' today' : ''}${hasEvents ? ' has-events' : ''}${hasDue ? ' has-due' : ''}${hasOverdue ? ' has-overdue' : ''}">${day}</div>`;
  }
  
  const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
  for (let i = 1; i <= totalCells - firstDay - daysInMonth; i++) {
    calDays += `<div class="mini-cal-day other">${i}</div>`;
  }
  
  const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  
  container.innerHTML = `
    ${overdueCount > 0 ? `<div class="mini-cal-overdue">‚ö†Ô∏è ${overdueCount} overdue</div>` : ''}
    <div class="mini-cal-header">
      <span class="mini-cal-title">üìÖ ${monthNames[month]} ${year}</span>
      <div class="mini-cal-nav">
        <button onclick="changeMonth(-1)">‚óÄ</button>
        <button onclick="goToToday()">‚Ä¢</button>
        <button onclick="changeMonth(1)">‚ñ∂</button>
      </div>
    </div>
    <div class="mini-cal-grid">${calDays}</div>
    <div class="mini-cal-events">
      ${events.length === 0 ? `<div class="mini-cal-empty">No ${type} events</div>` : events.slice(0, 4).map(e => `
        <div class="mini-cal-event">
          <div class="mini-cal-event-dot" style="background:${e.color}"></div>
          <span class="mini-cal-event-text">${escapeHtml(e.title)}</span>
        </div>
      `).join('')}
      ${events.length > 4 ? `<div class="mini-cal-empty">+${events.length - 4} more</div>` : ''}
    </div>
    <div class="mini-cal-link" onclick="switchTab('calendar')">View Full Calendar</div>
  `;
}

function createList() {
  const title = document.getElementById('list-title').value.trim();
  if (!title) { showToast('Please enter a title'); return; }
  lists.unshift({ id: generateId(), title, items: [] });
  document.getElementById('list-title').value = '';
  renderLists();
  showToast('Checklist created!');
}

function deleteList(id) {
  if (confirm('Delete this checklist?')) {
    lists = lists.filter(l => l.id !== id);
    delete listRecurring[id];
    delete listReminders[id];
    renderLists();
    showToast('Checklist deleted');
  }
}

function addListItem(listId) {
  const input = document.getElementById(`add-item-${listId}`);
  const text = input.value.trim();
  if (!text) return;
  lists.find(l => l.id === listId).items.push({ text, completed: false });
  input.value = '';
  renderLists();
}

function toggleItem(listId, itemIndex) {
  const list = lists.find(l => l.id === listId);
  list.items[itemIndex].completed = !list.items[itemIndex].completed;
  renderLists();
}

function deleteListItem(listId, itemIndex) {
  lists.find(l => l.id === listId).items.splice(itemIndex, 1);
  renderLists();
}

function resetList(listId) {
  lists.find(l => l.id === listId).items.forEach(item => item.completed = false);
  renderLists();
  showToast('Checklist reset!');
}

function renderLists() {
  const container = document.getElementById('lists-container');
  document.getElementById('lists-count').textContent = lists.length;
  
  if (lists.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">‚òëÔ∏è</div><div class="empty-text">No checklists yet</div></div>`;
    return;
  }
  
  container.innerHTML = lists.map(list => {
    const completed = list.items.filter(i => i.completed).length;
    const total = list.items.length;
    const hasRecurring = !!listRecurring[list.id];
    
    return `<div class="list-card">
      <div class="list-header">
        <div class="list-title">${escapeHtml(list.title)}${hasRecurring ? '<span class="config-badge">üîÑ Recurring</span>' : ''}</div>
        <div class="list-progress">${completed}/${total}</div>
      </div>
      <div class="list-items">
        ${list.items.length === 0 ? '<div style="color:var(--text-muted);font-size:0.85rem;padding:8px;">No items yet</div>' : list.items.map((item, i) => `
          <div class="list-item">
            <input type="checkbox" class="item-checkbox" ${item.completed ? 'checked' : ''} onchange="toggleItem('${list.id}',${i})">
            <span class="item-text ${item.completed ? 'completed' : ''}">${escapeHtml(item.text)}</span>
            <button class="btn btn-sm btn-danger item-delete" onclick="deleteListItem('${list.id}',${i})">√ó</button>
          </div>
        `).join('')}
      </div>
      <div class="add-item-form">
        <input type="text" id="add-item-${list.id}" placeholder="Add new item..." onkeypress="if(event.key==='Enter')addListItem('${list.id}')">
        <button class="btn btn-sm" onclick="addListItem('${list.id}')">Add</button>
      </div>
      <div class="list-actions">
        <button class="btn btn-sm btn-secondary" onclick="resetList('${list.id}')">üîÑ Reset</button>
        <button class="btn btn-sm ${hasRecurring ? 'btn-success' : 'btn-secondary'}">üìÖ Recurring</button>
        <button class="btn btn-sm btn-danger" onclick="deleteList('${list.id}')">Delete</button>
      </div>
    </div>`;
  }).join('');
  
  renderListsMiniCal();
}

function createTaskList() {
  const title = document.getElementById('task-list-title').value.trim();
  if (!title) { showToast('Please enter a title'); return; }
  taskLists.unshift({ 
    id: generateId(), 
    title, 
    statuses: [
      { id: 'todo', label: 'To Do', color: '#6b7280', order: 0 },
      { id: 'in_progress', label: 'In Progress', color: '#3b82f6', order: 1 },
      { id: 'completed', label: 'Completed', color: '#10b981', order: 2 }
    ],
    items: [] 
  });
  document.getElementById('task-list-title').value = '';
  renderTasks();
  renderKanban();
  showToast('Task list created!');
}

function cycleStatus(taskListId, itemIndex) {
  const taskList = taskLists.find(t => t.id === taskListId);
  const item = taskList.items[itemIndex];
  const statusIds = taskList.statuses.map(s => s.id);
  const currentIndex = statusIds.indexOf(item.status);
  item.status = statusIds[(currentIndex + 1) % statusIds.length];
  renderTasks();
  renderKanban();
}

function renderTasks() {
  const container = document.getElementById('tasks-container');
  document.getElementById('tasks-count').textContent = taskLists.length;
  
  if (taskLists.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">üìã</div><div class="empty-text">No task lists yet</div></div>`;
    return;
  }
  
  container.innerHTML = taskLists.map(taskList => {
    const completedCount = taskList.items.filter(i => i.status === 'completed').length;
    
    return `<div class="task-card">
      <div class="task-header">
        <div class="task-title">${escapeHtml(taskList.title)}</div>
        <div class="list-progress">${completedCount}/${taskList.items.length}</div>
      </div>
      <div class="task-items">
        ${taskList.items.length === 0 ? '<div style="color:var(--text-muted);font-size:0.85rem;padding:8px;">No items yet</div>' : taskList.items.map((item, i) => {
          const status = taskList.statuses.find(s => s.id === item.status) || taskList.statuses[0];
          return `<div class="task-item depth-${item.depth || 0}">
            <span class="status-pill" style="background:${status.color};color:#fff;" onclick="cycleStatus('${taskList.id}',${i})">${status.label}</span>
            <span class="item-text">${escapeHtml(item.text)}</span>
          </div>`;
        }).join('')}
      </div>
    </div>`;
  }).join('');
  
  renderTasksMiniCal();
}

function renderKanban() {
  const container = document.getElementById('kanban-container');
  if (taskLists.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">üìä</div><div class="empty-text">No Kanban boards yet</div><div class="empty-hint">Create a task list to see it here</div></div>`;
    return;
  }
  
  container.innerHTML = taskLists.map(taskList => {
    const completedCount = taskList.items.filter(i => i.status === 'completed').length;
    
    return `<div class="kanban-task-card">
      <div class="kanban-header">
        <div class="kanban-title">${escapeHtml(taskList.title)}</div>
        <div style="display:flex;align-items:center;">
          <button class="kanban-layout-btn" onclick="toggleKanbanLayout(this)">‚¨ç Vertical</button>
          <div class="kanban-progress">${completedCount}/${taskList.items.length}</div>
        </div>
      </div>
      <div class="kanban-board">
        ${taskList.statuses.sort((a,b) => a.order - b.order).map(status => {
          const statusItems = taskList.items.filter(i => i.status === status.id && (i.depth || 0) === 0);
          return `<div class="kanban-column">
            <div class="kanban-col-header" style="background:${status.color}33;color:${status.color}">
              <div class="kanban-col-dot" style="background:${status.color}"></div>
              ${status.label}
              <span class="kanban-col-count">${statusItems.length}</span>
            </div>
            <div class="kanban-dropzone">
              ${statusItems.length === 0 ? '<div class="kanban-empty">Drop items here</div>' : statusItems.map(item => `
                <div class="kanban-item" style="border-left-color:${status.color}" draggable="true">
                  <div class="kanban-item-text">${escapeHtml(item.text)}</div>
                </div>
              `).join('')}
            </div>
          </div>`;
        }).join('')}
      </div>
    </div>`;
  }).join('');
}

function toggleKanbanLayout(btn) {
  const board = btn.closest('.kanban-task-card').querySelector('.kanban-board');
  board.classList.toggle('vertical');
  btn.textContent = board.classList.contains('vertical') ? '‚¨å Horizontal' : '‚¨ç Vertical';
}

function generateCalendarEvents() {
  calendarEvents = [];
  const today = formatDate(new Date());
  
  notes.forEach(note => {
    calendarEvents.push({ date: note.created.split('T')[0], title: note.title, type: 'note-created', color: eventColors['note-created'] });
  });
  
  lists.forEach(list => {
    if (list.dueDate) {
      calendarEvents.push({ date: list.dueDate, title: list.title, type: 'list-due', color: eventColors['list-due'] });
    }
  });
  
  taskLists.forEach(taskList => {
    taskList.items.forEach(item => {
      if (item.dueDate) {
        const isOverdue = item.dueDate < today && item.status !== 'completed';
        calendarEvents.push({
          date: item.dueDate,
          title: `${taskList.title}: ${item.text}`,
          type: isOverdue ? 'task-overdue' : 'task-due',
          color: isOverdue ? eventColors['task-overdue'] : eventColors['task-due']
        });
      }
    });
  });
  
  const now = new Date();
  calendarEvents.push(
    { date: formatDate(new Date(now.getFullYear(), now.getMonth(), 15)), title: 'Team Meeting', type: 'imported', color: eventColors['imported'] },
    { date: formatDate(new Date(now.getFullYear(), now.getMonth(), 22)), title: 'Doctor Appointment', type: 'imported', color: eventColors['imported'] }
  );
}

function renderCalendar() {
  generateCalendarEvents();
  const grid = document.getElementById('calendar-grid');
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const today = new Date();
  const todayStr = formatDate(today);
  
  document.getElementById('calendar-month-title').textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
  
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const prevMonthDays = new Date(year, month, 0).getDate();
  
  const eventsByDate = {};
  calendarEvents.forEach(e => {
    if (!eventsByDate[e.date]) eventsByDate[e.date] = [];
    eventsByDate[e.date].push(e);
  });
  
  let html = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d => `<div class="calendar-weekday">${d}</div>`).join('');
  
  for (let i = firstDay - 1; i >= 0; i--) {
    html += `<div class="calendar-day other-month"><span class="day-number">${prevMonthDays - i}</span></div>`;
  }
  
  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    const isToday = dateStr === todayStr;
    const dayEvents = eventsByDate[dateStr] || [];
    
    html += `<div class="calendar-day ${isToday ? 'today' : ''} ${dayEvents.length ? 'has-events' : ''}">
      <span class="day-number">${day}</span>
      <div class="day-events">
        ${dayEvents.slice(0, 3).map(e => `<div class="day-event" style="background:${e.color};color:#fff;">${escapeHtml(e.title)}</div>`).join('')}
        ${dayEvents.length > 3 ? `<div class="day-more">+${dayEvents.length - 3} more</div>` : ''}
      </div>
    </div>`;
  }
  
  const totalCells = Math.ceil((firstDay + daysInMonth) / 7) * 7;
  for (let i = 1; i <= totalCells - firstDay - daysInMonth; i++) {
    html += `<div class="calendar-day other-month"><span class="day-number">${i}</span></div>`;
  }
  
  grid.innerHTML = html;
  renderUpcomingEvents();
  renderIcalSources();
  renderColorSettings();
  renderOverdueBanner();
}

function renderUpcomingEvents() {
  const container = document.getElementById('upcoming-events');
  const todayStr = formatDate(new Date());
  const upcoming = calendarEvents.filter(e => e.date >= todayStr).sort((a, b) => a.date.localeCompare(b.date)).slice(0, 6);
  
  if (upcoming.length === 0) {
    container.innerHTML = '<div class="mini-cal-empty">No upcoming events</div>';
    return;
  }
  
  container.innerHTML = upcoming.map(e => `
    <div class="upcoming-event">
      <div class="upcoming-event-dot" style="background:${e.color}"></div>
      <div class="upcoming-event-content">
        <div class="upcoming-event-title">${escapeHtml(e.title)}</div>
        <div class="upcoming-event-time">${formatEventDate(e.date)}</div>
      </div>
    </div>
  `).join('');
}

function renderIcalSources() {
  const container = document.getElementById('ical-sources');
  if (icalSources.length === 0) {
    container.innerHTML = '<div class="mini-cal-empty">No calendars imported</div>';
    return;
  }
  container.innerHTML = icalSources.map((s, i) => `
    <div class="ical-source">
      <div>
        <div class="ical-source-name">${escapeHtml(s.name)}</div>
        <div class="ical-source-status">‚úì Synced</div>
      </div>
      <button class="btn btn-sm btn-danger" onclick="removeIcalSource(${i})">√ó</button>
    </div>
  `).join('');
}

function renderColorSettings() {
  const container = document.getElementById('color-settings');
  const colorTypes = [
    { key: 'note-created', label: 'Note Created' },
    { key: 'note-edited', label: 'Note Edited' },
    { key: 'list-due', label: 'List Due' },
    { key: 'task-due', label: 'Task Due' },
    { key: 'task-overdue', label: 'Overdue' },
    { key: 'imported', label: 'Imported' }
  ];
  
  container.innerHTML = colorTypes.map(t => `
    <div class="color-row">
      <span class="color-label"><span class="color-preview" style="background:${eventColors[t.key]}"></span>${t.label}</span>
      <input type="color" class="color-input" value="${eventColors[t.key]}" onchange="updateColor('${t.key}', this.value)">
    </div>
  `).join('');
}

function renderOverdueBanner() {
  const container = document.getElementById('overdue-banner-container');
  const todayStr = formatDate(new Date());
  const overdueCount = calendarEvents.filter(e => e.type === 'task-overdue').length;
  
  if (overdueCount > 0) {
    container.innerHTML = `<div class="overdue-banner">‚ö†Ô∏è You have <span class="overdue-count">${overdueCount}</span> overdue item${overdueCount > 1 ? 's' : ''}</div>`;
  } else {
    container.innerHTML = '';
  }
}

function updateColor(key, value) {
  eventColors[key] = value;
  renderCalendar();
  showToast('Color updated!');
}

function changeMonth(delta) {
  currentDate.setMonth(currentDate.getMonth() + delta);
  renderCalendar();
  renderNotesMiniCal();
  renderListsMiniCal();
  renderTasksMiniCal();
}

function goToToday() {
  currentDate = new Date();
  renderCalendar();
  renderNotesMiniCal();
  renderListsMiniCal();
  renderTasksMiniCal();
}

function importIcal() {
  const url = document.getElementById('ical-url').value.trim();
  const name = document.getElementById('ical-name').value.trim() || 'Imported Calendar';
  if (!url) { showToast('Please enter a calendar URL'); return; }
  icalSources.push({ name, url, status: 'synced' });
  document.getElementById('ical-url').value = '';
  document.getElementById('ical-name').value = '';
  renderIcalSources();
  showToast(`Imported "${name}"!`);
}

function removeIcalSource(index) {
  const name = icalSources[index].name;
  icalSources.splice(index, 1);
  renderIcalSources();
  showToast(`Removed "${name}"`);
}

function toggleCalendarSettings() {
  showToast('Settings panel opens in the real dashboard!');
}

function generateId() { return 'xxxx-xxxx-xxxx'.replace(/x/g, () => Math.floor(Math.random() * 16).toString(16)); }
function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
function formatDate(date) { return date.toISOString().split('T')[0]; }
function formatDateTime(isoString) { return new Date(isoString).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }); }
function formatEventDate(dateStr) {
  const d = new Date(dateStr + 'T12:00:00');
  const today = new Date();
  const tomorrow = new Date(today); tomorrow.setDate(tomorrow.getDate() + 1);
  if (dateStr === formatDate(today)) return 'Today';
  if (dateStr === formatDate(tomorrow)) return 'Tomorrow';
  return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}
function renderMarkdown(text) {
  return text.replace(/^### (.+)$/gm, '<h3>$1</h3>').replace(/^## (.+)$/gm, '<h2>$1</h2>').replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>').replace(/\*(.+?)\*/g, '<em>$1</em>').replace(/`(.+?)`/g, '<code>$1</code>')
    .replace(/^> (.+)$/gm, '<blockquote>$1</blockquote>').replace(/^- (.+)$/gm, '<li>$1</li>').replace(/\n/g, '<br>');
}
function showToast(message) { const toast = document.getElementById('toast'); toast.textContent = message; toast.classList.add('show'); setTimeout(() => toast.classList.remove('show'), 2500); }
function openImageModal(src) { document.getElementById('modal-image').src = src; document.getElementById('image-modal').classList.add('show'); }
function closeImageModal() { document.getElementById('image-modal').classList.remove('show'); }
function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('show'); document.getElementById('mobile-overlay').classList.toggle('show'); document.body.style.overflow = document.getElementById('mobile-menu').classList.contains('show') ? 'hidden' : ''; }
function switchTabMobile(tabName) { toggleMobileMenu(); switchTab(tabName); }
function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
  document.getElementById(tabName + '-tab').classList.add('active');
  if (tabName === 'calendar') renderCalendar();
}
function toggleSendPanel(noteId) { showToast('Send/Schedule panel opens in the real dashboard!'); }

function renderAll() {
  renderNotes();
  renderLists();
  renderTasks();
  renderKanban();
  renderCalendar();
}

document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeImageModal(); });
</script>
</body>
</html>
